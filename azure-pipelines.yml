pr:
- dev/jaredpar/*

jobs:
- job: VsVim_Build 
  pool: 
    vmImage: 'vs2017-win2016'
  steps:

  - task: PowerShell@2
    displayName: Build 
    inputs:
      filePath: Scripts\Build.ps1
      arguments: -ci -config Debug -build

  - task: PowerShell@2
    displayName: Test
    inputs:
      filePath: Scripts\Build.ps1
      arguments: -ci -config Debug -test

  - task: PowerShell@2
    displayName: Test Extra
    inputs:
      filePath: Scripts\Build.ps1
      arguments: -ci -config Debug -testExtra

  - task: PublishPipelineArtifact@0
    displayName: Publish Vsix 
    inputs:
      targetPath: '$(Build.SourcesDirectory)\Binaries\Deploy'
      artifactName: 'Vsix'

  - task: PublishPipelineArtifact@0
    displayName: Publish Logs
    inputs:
      targetPath: '$(Build.SourcesDirectory)\Binaries\Logs'
      artifactName: 'Logs'
    condition: always()

  - task: PublishTestResults@2
    displayName: Publish xUnit Test Results
    inputs:
      testRunner: XUnit
      testResultsFiles: '$(Build.SourcesDirectory)\Binaries\xUnitResults\*.xml'
      mergeTestResults: true
      testRunTitle: 'VsVim Test Results'
    condition: always()
